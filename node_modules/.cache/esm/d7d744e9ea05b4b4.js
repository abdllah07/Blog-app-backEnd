let Comment,Post;_ea0‍.x([["createComment",()=>createComment],["updateComment",()=>updateComment],["deleteComment",()=>deleteComment]]);_ea0‍.w("../models/Comment",[["default",["Comment"],function(v){Comment=v}]]);_ea0‍.w("../models/Post",[["default",["Post"],function(v){Post=v}]]);


const  createComment = async(req , res , next) => {
    try {
        const { desc , slug , parent  , replayOnUser} = req.body;

        const post = await Post.findOne({ slug : slug});

        if(!post) {
            const error = new Error("post not found");
            return next(error);
        }
        const newComment = new Comment ({
            user : req.user._id,
            desc,
            post : post._id,
            parent,
            replayOnUser ,
        });
        const savedComment = await newComment.save(newComment);
        return res.json(savedComment);

    } catch (error) {
        next(error);
    }
}

const  updateComment = async(req , res , next) => {
    try {
        const {desc} = req.body;

        const comment = await Comment.findById(req.params.commentId);

        if(!comment) {
            const error = new Error("comment not found");
            return next(error);
        }

        comment.desc = desc || comment.desc;k
        const updatedComment = await comment.save(comment);
        return res.json(updatedComment);


    } catch (error) {
        next(error);
    }
}

const  deleteComment = async(req , res , next) => {
    try {
        const {desc} = req.body;

        const comment = await Comment.findById(req.params.commentId);

        if(!comment) {
            const error = new Error("comment not found");
            return next(error);
        }

        comment.desc = desc || comment.desc;k
        const updatedComment = await comment.save(comment);
        return res.json(updatedComment);


    } catch (error) {
        next(error);
    }
}


